# DTI6-TMS — Deployment Guide

**System:** DTI Region VI — Transmittal Management System  
**Date:** February 26, 2026

---

## Table of Contents

1. [System Requirements](#1-system-requirements)
2. [Installation Steps](#2-installation-steps)
3. [Environment Configuration](#3-environment-configuration)
4. [Database Setup](#4-database-setup)
5. [Asset Compilation](#5-asset-compilation)
6. [XAMPP / Apache Configuration](#6-xampp--apache-configuration)
7. [Post-Deployment Checklist](#7-post-deployment-checklist)
8. [Updating the Application](#8-updating-the-application)
9. [Backup & Restore](#9-backup--restore)
10. [Troubleshooting](#10-troubleshooting)

---

## 1. System Requirements

### Server Requirements

| Component | Minimum | Recommended |
|---|---|---|
| **PHP** | 7.4 | 8.0+ |
| **MySQL** | 5.7 | 8.0 |
| **Apache** | 2.4 | 2.4+ with mod_rewrite |
| **Composer** | 2.x | Latest |
| **Node.js** | 14.x | 16.x+ |
| **NPM** | 6.x | 8.x+ |
| **RAM** | 512 MB | 1 GB+ |
| **Disk Space** | 200 MB | 500 MB+ |

### Required PHP Extensions

- `php-mbstring`
- `php-xml`
- `php-pdo`
- `php-mysql`
- `php-curl`
- `php-gd` (for QR code generation)
- `php-zip`
- `php-json`
- `php-openssl`
- `php-tokenizer`

---

## 2. Installation Steps

### 2.1 Clone the Repository

```bash
git clone <repository-url> dti6-tms
cd dti6-tms
```

### 2.2 Install PHP Dependencies

```bash
composer install --no-dev --optimize-autoloader
```

> For development environments, omit `--no-dev`:
> ```bash
> composer install
> ```

### 2.3 Install Node.js Dependencies

```bash
npm install
```

### 2.4 Create Environment File

```bash
cp .env.example .env
```

### 2.5 Generate Application Key

```bash
php artisan key:generate
```

### 2.6 Configure the `.env` File

Edit the `.env` file with your database and application settings (see [Section 3](#3-environment-configuration)).

### 2.7 Run Database Migrations

```bash
php artisan migrate
```

### 2.8 Seed the Database

```bash
php artisan db:seed
```

This creates:
- 7 offices (1 Regional + 6 Provincial)
- 5 divisions (under RO6)
- 2 roles (Admin, User) with 13 permissions
- 2 default accounts (admin@dti6.gov.ph, user@dti6.gov.ph)

### 2.9 Compile Frontend Assets

```bash
# Development (unminified, with source maps)
npm run dev

# Production (minified, optimized)
npm run production
```

### 2.10 Set Directory Permissions

```bash
# On Linux/Mac:
chmod -R 775 storage bootstrap/cache
chown -R www-data:www-data storage bootstrap/cache

# On Windows (XAMPP):
# Ensure storage\ and bootstrap\cache\ are writable by Apache
```

---

## 3. Environment Configuration

### Full `.env` Reference

```ini
# ── Application ──────────────────────────────────────────────
APP_NAME="DTI6-TMS"                         # Display name in browser title
APP_ENV=production                           # local | production
APP_KEY=                                     # Generated by php artisan key:generate
APP_DEBUG=false                              # true for dev, false for production
APP_URL=http://localhost/dti6-tms/public     # Full URL to the public/ directory
ASSET_URL="${APP_URL}"                       # Asset URL (same as APP_URL)

# ── Logging ──────────────────────────────────────────────────
LOG_CHANNEL=stack                            # stack | single | daily
LOG_LEVEL=error                              # debug | info | warning | error

# ── Database ─────────────────────────────────────────────────
DB_CONNECTION=mysql                          # mysql | sqlite
DB_HOST=127.0.0.1                            # Database host
DB_PORT=3306                                 # MySQL default port
DB_DATABASE=dtsdb                            # Database name
DB_USERNAME=dtsuser                          # Database user
DB_PASSWORD=                                 # Database password

# ── Session & Cache ──────────────────────────────────────────
BROADCAST_DRIVER=log
CACHE_DRIVER=file                            # file | redis | database
FILESYSTEM_DRIVER=local
QUEUE_CONNECTION=sync                        # sync | database | redis
SESSION_DRIVER=file                          # file | database | redis
SESSION_LIFETIME=120                         # Minutes
SESSION_DOMAIN=null
SESSION_SECURE_COOKIE=false                  # true if using HTTPS

# ── Mail (Optional) ─────────────────────────────────────────
MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=                               # SMTP username
MAIL_PASSWORD=                               # SMTP password or app password
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=                           # noreply@dti6.gov.ph
MAIL_FROM_NAME="${APP_NAME}"
```

### Critical Settings for Production

| Setting | Development | Production |
|---|---|---|
| `APP_ENV` | `local` | `production` |
| `APP_DEBUG` | `true` | `false` |
| `LOG_LEVEL` | `debug` | `error` |
| `SESSION_SECURE_COOKIE` | `false` | `true` (if HTTPS) |

---

## 4. Database Setup

### 4.1 Create the Database

```sql
CREATE DATABASE dtsdb CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'dtsuser'@'localhost' IDENTIFIED BY 'your_secure_password';
GRANT ALL PRIVILEGES ON dtsdb.* TO 'dtsuser'@'localhost';
FLUSH PRIVILEGES;
```

### 4.2 Run Migrations

```bash
php artisan migrate
```

### 4.3 Seed Default Data

```bash
# Run all seeders (offices, roles, permissions, divisions, users)
php artisan db:seed

# Or run individual seeders
php artisan db:seed --class=OfficeSeeder
php artisan db:seed --class=RolesAndPermissionsSeeder
php artisan db:seed --class=DocumentLogPermissionSeeder
php artisan db:seed --class=DivisionSeeder
```

### 4.4 Verify Seeded Data

```bash
php artisan tinker
>>> \App\Models\Office::count();  // Should return 7
>>> \App\Models\Division::count(); // Should return 5
>>> \App\Models\User::count();    // Should return 2
>>> \Spatie\Permission\Models\Role::count(); // Should return 2
>>> \Spatie\Permission\Models\Permission::count(); // Should return 13
```

---

## 5. Asset Compilation

### Development (with hot-reload)

```bash
npm run watch
```

### Production Build

```bash
npm run production
```

### Compiled Output

| Source | Output |
|---|---|
| `resources/css/app.css` | `public/css/app.css` |
| `resources/js/app.js` | `public/js/app.js` |

---

## 6. XAMPP / Apache Configuration

### Virtual Host Configuration

Add to `httpd-vhosts.conf` (typically at `C:\xampp\apache\conf\extra\httpd-vhosts.conf`):

```apache
<VirtualHost *:80>
    ServerName dti6-tms.local
    DocumentRoot "C:/dev/xampp/htdocs/dti6-tms/public"

    <Directory "C:/dev/xampp/htdocs/dti6-tms/public">
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog "logs/dti6-tms-error.log"
    CustomLog "logs/dti6-tms-access.log" common
</VirtualHost>
```

### Hosts File (for local development)

Add to `C:\Windows\System32\drivers\etc\hosts`:

```
127.0.0.1    dti6-tms.local
```

### Subdirectory Deployment (Alternative)

If deploying under a subdirectory (e.g., `http://localhost/dti6-tms/public`):

1. Ensure `.env` has `APP_URL=http://localhost/dti6-tms/public`
2. The `public/.htaccess` file handles URL rewriting automatically

### Required Apache Modules

- `mod_rewrite` — URL rewriting (required)
- `mod_headers` — Security headers (recommended)

---

## 7. Post-Deployment Checklist

```bash
# 1. Clear all caches
php artisan config:clear
php artisan cache:clear
php artisan route:clear
php artisan view:clear

# 2. Cache configuration for production (performance)
php artisan config:cache
php artisan route:cache
php artisan view:cache

# 3. Verify storage link (if not already created)
php artisan storage:link

# 4. Run permission cache reset
php artisan permission:cache-reset
```

### Security Checklist

- [ ] `APP_DEBUG` is set to `false`
- [ ] `APP_ENV` is set to `production`
- [ ] Default account passwords have been changed
- [ ] Database credentials are secure
- [ ] `storage/` and `bootstrap/cache/` are writable
- [ ] `public/` is the only publicly accessible directory
- [ ] HTTPS is configured (recommended)
- [ ] MySQL is not exposed to public network

---

## 8. Updating the Application

### Standard Update Procedure

```bash
# 1. Pull latest code
git pull origin main

# 2. Install/update dependencies
composer install --no-dev --optimize-autoloader
npm install

# 3. Run new migrations
php artisan migrate

# 4. Compile assets
npm run production

# 5. Clear and rebuild caches
php artisan config:cache
php artisan route:cache
php artisan view:cache
php artisan permission:cache-reset
```

---

## 9. Backup & Restore

### Database Backup

```bash
# Using mysqldump
mysqldump -u dtsuser -p dtsdb > backup_$(date +%Y%m%d_%H%M%S).sql

# On Windows (XAMPP)
C:\xampp\mysql\bin\mysqldump -u dtsuser -p dtsdb > backup.sql
```

### Database Restore

```bash
mysql -u dtsuser -p dtsdb < backup.sql
```

### Application Backup

Back up the entire project directory, especially:
- `.env` file (contains encryption key and credentials)
- `storage/` directory (logs, cached files)
- Database dump

---

## 10. Troubleshooting

### Common Issues

| Issue | Cause | Solution |
|---|---|---|
| **500 Internal Server Error** | Missing `.env` or `APP_KEY` | Run `php artisan key:generate` |
| **Storage permission error** | `storage/` not writable | `chmod -R 775 storage bootstrap/cache` |
| **Class not found** | Autoload out of date | `composer dump-autoload` |
| **Route not found (404)** | mod_rewrite disabled | Enable `mod_rewrite` in Apache |
| **CSRF token mismatch** | Session expired or misconfigured | Check `SESSION_DRIVER` and clear browser cookies |
| **APP_KEY concatenation** | Key not properly replaced | Delete old key, re-run `php artisan key:generate` |
| **Permission denied (roles)** | Permission cache stale | `php artisan permission:cache-reset` |
| **Mix manifest missing** | Assets not compiled | Run `npm run dev` or `npm run production` |
| **QR code not rendering** | Missing GD extension | Install `php-gd` extension |
| **PDF download fails** | DomPDF config issue | Check `config/dompdf.php` settings |

### Log Files

| Log | Location | Purpose |
|---|---|---|
| Laravel Log | `storage/logs/laravel.log` | Application errors and debug info |
| Apache Error Log | XAMPP `logs/error.log` | Server-level errors |
| Apache Access Log | XAMPP `logs/access.log` | Request history |

### Useful Artisan Commands

```bash
php artisan about                    # System info summary
php artisan route:list               # All registered routes
php artisan permission:show          # All roles and permissions
php artisan migrate:status           # Migration status
php artisan tinker                   # Interactive REPL
```

---

_Document Version: 1.2 — Last Updated: February 26, 2026_
